# vim: tw=0:
FROM alpine:3.9 AS build-stage

RUN echo -e $'\n\
ï¼¿äººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººï¼¿\n\
ï¼ã€€super_unkoã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä»Šã‹ã‚‰ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã‚ˆï¼ã€€ï¼œ\n\
ï¼ã€€ã“ã‚Œã«ã¯å°‘ã—æ™‚é–“ãŒã‹ã‹ã‚‹ã‚ˆï¼ã€€ã€€ã€€ã€€ã€€ã€€ã€€ï¼œ\n\
ï¿£Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^ï¿£\n\
ã€€ã€€ã€€ã€€ã€€ã€€ğŸ‘‘\n\
ã€€ã€€ã€€ã€€ï¼ˆğŸ’©ğŸ’©ğŸ’©ï¼‰\n\
ã€€ã€€ã€€ï¼ˆğŸ’©ğŸ‘ğŸ’©ğŸ‘ğŸ’©ï¼‰\n\
ã€€ã€€ï¼ˆğŸ’©ğŸ’©ğŸ’©ğŸ‘ƒğŸ’©ğŸ’©ğŸ’©ï¼‰\n\
ã€€ï¼ˆğŸ’©ğŸ’©ğŸ’©ğŸ’©ğŸ‘„ğŸ’©ğŸ’©ğŸ’©ğŸ’©ï¼‰'

ENV DIR_PREFIX /usr/local
ENV SRC_DIR $DIR_PREFIX/src
ENV BIN_DIR $DIR_PREFIX/bin

RUN apk --no-cache add \
      git \
      bash \
      perl \
      make \
      automake \
      autoconf \
      pkgconfig \
      gcc \
      musl-dev \
      libcaca-dev \
      figlet \
    && git clone https://github.com/fumiyas/home-commands.git $SRC_DIR/home-commands \
    && install -m 0755 $SRC_DIR/home-commands/echo-sd $BIN_DIR/ \
    && git clone https://github.com/schacon/cowsay.git $SRC_DIR/cowsay \
    && (cd $SRC_DIR/cowsay && ./install.sh) \
    && git clone https://github.com/cacalabs/toilet $SRC_DIR/toilet \
    && cd $SRC_DIR/toilet \
    && ./bootstrap \
    && ./configure \
    && make \
    && install -m 0755 ./src/toilet $BIN_DIR \
    && mkdir /usr/local/share/figlet/ \
    && install -m 0644 ./fonts/*.tlf /usr/local/share/figlet/
COPY . ${SRC_DIR}/super_unko
RUN ${SRC_DIR}/super_unko/install.sh

FROM alpine:3.9 AS exec-stage
RUN apk add --no-cache \
      bash \
      perl \
      libcaca-dev \
      bc \
      ncurses
COPY --from=build-stage /usr/local/bin/* /usr/local/bin/
COPY --from=build-stage /usr/local/src/toilet/fonts/* /usr/local/share/figlet/
COPY --from=build-stage /usr/local/lib/super_unko /usr/local/lib/super_unko

RUN echo -e $'\n\
ï¼¿äººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººï¼¿\n\
ï¼ã€€super_unkoã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ãŒç„¡äº‹å®Œäº†ã—ãŸã‚ˆï¼ã€€ï¼œ\n\
ï¿£Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^ï¿£\n\
ã€€ã€€ã€€ã€€ã€€ã€€ğŸ‘‘\n\
ã€€ã€€ã€€ã€€ï¼ˆğŸ’©ğŸ’©ğŸ’©ï¼‰\n\
ã€€ã€€ã€€ï¼ˆğŸ’©ğŸ‘ğŸ’©ğŸ‘ğŸ’©ï¼‰\n\
ã€€ã€€ï¼ˆğŸ’©ğŸ’©ğŸ’©ğŸ‘ƒğŸ’©ğŸ’©ğŸ’©ï¼‰\n\
ã€€ï¼ˆğŸ’©ğŸ’©ğŸ’©ğŸ’©ğŸ‘„ğŸ’©ğŸ’©ğŸ’©ğŸ’©ï¼‰'
