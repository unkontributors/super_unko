# vim: tw=0:
FROM ubuntu:20.04 AS base

RUN echo -e $'\n\
ï¼¿äººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººï¼¿\n\
ï¼ã€€super_unkoã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä»Šã‹ã‚‰ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã‚ˆï¼ã€€ï¼œ\n\
ï¼ã€€ã“ã‚Œã«ã¯å°‘ã—æ™‚é–“ãŒã‹ã‹ã‚‹ã‚ˆï¼ã€€ã€€ã€€ã€€ã€€ã€€ã€€ï¼œ\n\
ï¿£Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^ï¿£\n\
ã€€ã€€ã€€ã€€ã€€ã€€ğŸ‘‘\n\
ã€€ã€€ã€€ã€€ï¼ˆğŸ’©ğŸ’©ğŸ’©ï¼‰\n\
ã€€ã€€ã€€ï¼ˆğŸ’©ğŸ‘ğŸ’©ğŸ‘ğŸ’©ï¼‰\n\
ã€€ã€€ï¼ˆğŸ’©ğŸ’©ğŸ’©ğŸ‘ƒğŸ’©ğŸ’©ğŸ’©ï¼‰\n\
ã€€ï¼ˆğŸ’©ğŸ’©ğŸ’©ğŸ’©ğŸ‘„ğŸ’©ğŸ’©ğŸ’©ğŸ’©ï¼‰'

ENV LANG ja_JP.UTF-8
RUN apt update -yqq \
    && apt install -y --no-install-recommends \
       toilet \
       figlet \
       bc \
       cowsay \
       curl \
       ca-certificates \
       locales \
    && locale-gen ja_JP.UTF-8 \
    && rm -rf /var/lib/apt/lists/*
COPY . /usr/local/src/super_unko
WORKDIR /usr/local/src/super_unko
RUN ./install.sh
RUN curl --retry 3 https://raw.githubusercontent.com/fumiyas/home-commands/master/echo-sd > /usr/local/bin/echo-sd
RUN chmod +x /usr/local/bin/echo-sd

RUN echo -e $'\n\
ï¼¿äººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººäººï¼¿\n\
ï¼ã€€super_unkoã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ãŒç„¡äº‹å®Œäº†ã—ãŸã‚ˆï¼ã€€ï¼œ\n\
ï¿£Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^ï¿£\n\
ã€€ã€€ã€€ã€€ã€€ã€€ğŸ‘‘\n\
ã€€ã€€ã€€ã€€ï¼ˆğŸ’©ğŸ’©ğŸ’©ï¼‰\n\
ã€€ã€€ã€€ï¼ˆğŸ’©ğŸ‘ğŸ’©ğŸ‘ğŸ’©ï¼‰\n\
ã€€ã€€ï¼ˆğŸ’©ğŸ’©ğŸ’©ğŸ‘ƒğŸ’©ğŸ’©ğŸ’©ï¼‰\n\
ã€€ï¼ˆğŸ’©ğŸ’©ğŸ’©ğŸ’©ğŸ‘„ğŸ’©ğŸ’©ğŸ’©ğŸ’©ï¼‰'

FROM base AS ci

ARG SH_VERSION=default

# Install bash-x.x
COPY ./docker/install_bash.sh /tmp/install_bash.sh
RUN apt update -yqq \
    && apt install -y --no-install-recommends build-essential bats byacc \
    && rm -rf /var/lib/apt/lists/* \
    && /tmp/install_bash.sh ${SH_VERSION} \
    && ./install.sh
