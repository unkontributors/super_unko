#!/usr/bin/env bats

readonly TARGET_COMMAND="$(pwd)/../bin/unko.king"

@test "-h ã§ãƒ˜ãƒ«ãƒ—ã‚’å‡ºåŠ›ã™ã‚‹" {
  run "$TARGET_COMMAND" -h
  [ "$status" -eq 0 ]
  [[ "${lines[0]}" =~ ^unko.king.* ]]
}

@test "--help ã§ãƒ˜ãƒ«ãƒ—ã‚’å‡ºåŠ›ã™ã‚‹" {
  run "$TARGET_COMMAND" --help
  [ "$status" -eq 0 ]
  [[ "${lines[0]}" =~ ^unko.king.* ]]
}

@test "-v ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å‡ºåŠ›ã™ã‚‹" {
  run "$TARGET_COMMAND" -v
  [ "$status" -eq 0 ]
  [[ "${lines[0]}" =~ ^v ]]
}

@test "--version ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å‡ºåŠ›ã™ã‚‹" {
  run "$TARGET_COMMAND" --version
  [ "$status" -eq 0 ]
  [[ "${lines[0]}" =~ ^v ]]
}

@test "å¼•æ•°æœªæŒ‡å®šã®æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ5ã«ãªã‚‹" {
  run "$TARGET_COMMAND"
  [ "$status" -eq 0 ]
  [ "${lines[0]}" = "ã€€ã€€ã€€ã€€ã€€ã€€ðŸ‘‘" ]
  [ "${lines[1]}" = "ã€€ã€€ã€€ã€€ï¼ˆðŸ’©ðŸ’©ðŸ’©ï¼‰" ]
  [ "${lines[2]}" = "ã€€ã€€ã€€ï¼ˆðŸ’©ðŸ‘ðŸ’©ðŸ‘ðŸ’©ï¼‰" ]
  [ "${lines[3]}" = "ã€€ã€€ï¼ˆðŸ’©ðŸ’©ðŸ’©ðŸ‘ƒðŸ’©ðŸ’©ðŸ’©ï¼‰" ]
  [ "${lines[4]}" = "ã€€ï¼ˆðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ‘„ðŸ’©ðŸ’©ðŸ’©ðŸ’©ï¼‰" ]
}

@test "å¼•æ•° 5" {
  run "$TARGET_COMMAND" 5
  [ "$status" -eq 0 ]
  [ "${lines[0]}" = "ã€€ã€€ã€€ã€€ã€€ã€€ðŸ‘‘" ]
  [ "${lines[1]}" = "ã€€ã€€ã€€ã€€ï¼ˆðŸ’©ðŸ’©ðŸ’©ï¼‰" ]
  [ "${lines[2]}" = "ã€€ã€€ã€€ï¼ˆðŸ’©ðŸ‘ðŸ’©ðŸ‘ðŸ’©ï¼‰" ]
  [ "${lines[3]}" = "ã€€ã€€ï¼ˆðŸ’©ðŸ’©ðŸ’©ðŸ‘ƒðŸ’©ðŸ’©ðŸ’©ï¼‰" ]
  [ "${lines[4]}" = "ã€€ï¼ˆðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ‘„ðŸ’©ðŸ’©ðŸ’©ðŸ’©ï¼‰" ]
}

@test "å¼•æ•° 5 æœªæº€ã¯NG" {
  for i in -1 0 1 2 3 4; do
    run "$TARGET_COMMAND" $i
    [ "$status" -ne 0 ]
  done
}

@test "å¼•æ•° 6" {
  run "$TARGET_COMMAND" 6
  [ "$status" -eq 0 ]
  [ "${lines[0]}" = "ã€€ã€€ã€€ã€€ã€€ã€€ã€€ðŸ‘‘" ]
  [ "${lines[1]}" = "ã€€ã€€ã€€ã€€ã€€ï¼ˆðŸ’©ðŸ’©ðŸ’©ï¼‰" ]
  [ "${lines[2]}" = "ã€€ã€€ã€€ã€€ï¼ˆðŸ’©ðŸ‘ðŸ’©ðŸ‘ðŸ’©ï¼‰" ]
  [ "${lines[3]}" = "ã€€ã€€ã€€ï¼ˆðŸ’©ðŸ’©ðŸ’©ðŸ‘ƒðŸ’©ðŸ’©ðŸ’©ï¼‰" ]
  [ "${lines[4]}" = "ã€€ã€€ï¼ˆðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ‘„ðŸ’©ðŸ’©ðŸ’©ðŸ’©ï¼‰" ]
  [ "${lines[5]}" = "ã€€ï¼ˆðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ï¼‰" ]
}

@test "ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»¥å¤–ã®å¼•æ•°ã¯æ•°å€¤ã®ã¿å—ã‘ä»˜ã‘ã‚‹" {
  for i in a whoami '$(whoami)' ã‚ æ¼¢å­— "" - "*" / "?" '_[$(whoami >&2)]'; do
    run "$TARGET_COMMAND" "$i"
    [ "$status" -ne 0 ]
    [[ "$output" =~ ^.*ERR.*Invalid.*number.*$ ]]
  done
}

